<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation methods • DataFakeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulation methods">
<meta property="og:description" content="DataFakeR">
<meta property="og:image" content="https://openpharma.github.io/DataFakeR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataFakeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-thumbs-o-up"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/main.html">Welcome</a>
    </li>
    <li>
      <a href="../articles/datafaker_workflow.html">DataFakeR workflow</a>
    </li>
    <li>
      <a href="../articles/schema_structure.html">YAML schema structure</a>
    </li>
    <li>
      <a href="../articles/structure_from_db.html">Sourcing structure from database</a>
    </li>
    <li>
      <a href="../articles/simulation_options.html">Simulation Options</a>
    </li>
    <li>
      <a href="../articles/simulation_methods.html">Simulation Methods</a>
    </li>
    <li>
      <a href="../articles/extra_parameters.html">Extra parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/openpharma/DataFakeR/issues" class="external-link">
    <span class="fa fa-ambulance"></span>
     
    Issues
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/DataFakeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulation methods</h1>
                        <h4 data-toc-skip class="author">Krystian
Igras</h4>
            
            <h4 data-toc-skip class="date">2023-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DataFakeR/blob/HEAD/vignettes/simulation_methods.Rmd" class="external-link"><code>vignettes/simulation_methods.Rmd</code></a></small>
      <div class="hidden name"><code>simulation_methods.Rmd</code></div>

    </div>

    
    
<p>DataFakeR offers various methods for defining how exactly each column
should be simulated.</p>
<p>We can highlight the below four simulation method types:</p>
<ol style="list-style-type: decimal">
<li>Deterministic (formula or constraint-based) simulation.</li>
<li>Special method simulation.</li>
<li>Restricted simulation.</li>
<li>Default simulation.</li>
</ol>
<p>The package tries to simulate the column with each method, with
preserving the order of the above list.</p>
<p>That means, the package will try to simulate the column using special
method first and when such method cannot be executed (the conditions for
running such method are not met) then, the next method is applied. More
to that when one of the methods successfully generated the data, the
following ones are skipped.</p>
<p>The goal of this document is to describe each method providing
required details and, if applied, provide an information how each method
can be customized.</p>
<div class="section level3">
<h3 id="deterministic-formula-or-constraint-based-simulation-">Deterministic (formula or constraint-based) simulation.<a class="anchor" aria-label="anchor" href="#deterministic-formula-or-constraint-based-simulation-"></a>
</h3>
<p>Let’s imagine we want to generate tables that reflects standard
database used in the library. One of the tables used there, can be the
one describing all the books owned by the library.</p>
<p>The YAML configuration of such table can have a form:</p>
<pre><code><span><span class="co"># schema-books.yml</span></span>
<span><span class="va">public</span><span class="op">:</span></span>
<span>  <span class="va">tables</span><span class="op">:</span></span>
<span>    <span class="va">books</span><span class="op">:</span></span>
<span>      <span class="va">columns</span><span class="op">:</span></span>
<span>        <span class="va">book_id</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="fu">char</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span></span>
<span>        <span class="va">author</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="va">varchar</span></span>
<span>        <span class="va">title</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="va">varchar</span></span>
<span>        <span class="va">genre</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="va">varchar</span></span>
<span>        <span class="va">bought</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="va">date</span></span>
<span>        <span class="va">amount</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="va">smallint</span></span>
<span>        <span class="va">purchase_id</span><span class="op">:</span></span>
<span>          <span class="va">type</span><span class="op">:</span> <span class="va">varchar</span></span></code></pre>
<p>While running the standard simulation process we get the following
result:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_source.html">schema_source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id  author   title    genre      bought     amount purchase_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> OoVtwCbu QJoEYa   XLaS     xljCUY     1971-02-17 -<span style="color: #BB0000; text-decoration: underline;">28</span><span style="color: #BB0000;">970</span> ZUYlCSp    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cXxXjdFu fRZxZuvf h        dkvg       1982-12-06  -<span style="color: #BB0000; text-decoration: underline;">6</span><span style="color: #BB0000;">823</span> rMSssP     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> MCRxukhz VHwPDx   TSbmLV   WcDNUKrH   1999-06-19 -<span style="color: #BB0000; text-decoration: underline;">28</span><span style="color: #BB0000;">513</span> H          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ikcePHyu lHcxeV   NgJ      pci        2018-07-04 -<span style="color: #BB0000; text-decoration: underline;">17</span><span style="color: #BB0000;">965</span> kFBzBRvgOm </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> jpBYnLQM hQQLTzI  smigTbte IgQl       2012-03-14 -<span style="color: #BB0000; text-decoration: underline;">29</span><span style="color: #BB0000;">188</span> rQZkhhyVGb </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HVVTHHMY E        rQk      Uyyl       1983-05-07  <span style="text-decoration: underline;">11</span>159 L          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> NsCWpGdK Hjguim   NeZNdvuO NLeNbo     1996-09-13 -<span style="color: #BB0000; text-decoration: underline;">13</span><span style="color: #BB0000;">255</span> ZTzULgHyaI </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> GnuTiETO bi       Q        I          2016-05-26 -<span style="color: #BB0000; text-decoration: underline;">26</span><span style="color: #BB0000;">167</span> g          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> qXqqpWng q        zgwYViH  VYtwtjxadR 1994-08-08 -<span style="color: #BB0000; text-decoration: underline;">28</span><span style="color: #BB0000;">056</span> ziVQrHKuQS </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> kAYLTfSF oy       dMyfaUt  SBat       2010-05-15  <span style="text-decoration: underline;">24</span>932 oKAVZ</span></span></code></pre></div>
<p>Even though many columns don’t look realistic let’s take care of
<code>book_id</code> and <code>purchase_id</code> columns. From the
rules followed in the library, we know that:</p>
<ul>
<li>
<code>book_id</code> is the concatenation of first 4 letters from
<code>author</code>, <code>title</code> and <code>bought</code>,</li>
<li>
<code>purchase_id</code> is concatenation of word ‘purchase_’ and
column <code>bought</code> (such rule is checked by SQL
<code>purchase_id = 'purchase_' || bought</code> check constraint).</li>
</ul>
<p>If we want to preserve such rules, we have two options:</p>
<ul>
<li>store the rules as <code>check_constraints</code> rewritten in R
code,</li>
<li>define <code>book_id</code> and <code>purchase_id</code> using
formula.</li>
</ul>
<p>Let’s describe <code>purchase_id</code> using the first method:</p>
<pre><code># schema-books_2.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
        author:
          type: varchar
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>let’s update the source and plot column dependencies:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_2.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_methods_files/figure-html/unnamed-chunk-2-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>As you can see DataFakeR detected dependency between
<code>purchase_id</code> and <code>bought</code> column. More to that
the package will assure <code>bought</code> column will be simulated
before <code>purchase_id</code>.</p>
<p>Let’s take a quick look at the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id  author     title      genre     bought     amount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> obYnWkze leZ        eH         wuPcdqB   1974-04-22  <span style="text-decoration: underline;">31</span>400</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> suceMctW DIrDylVHb  Sh         dN        1996-09-09  <span style="text-decoration: underline;">25</span>250</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> JKZRpDRU jYbVn      hTSTv      jKJuYWecg 2016-03-15  <span style="text-decoration: underline;">32</span>340</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SjiJcVUe NsuEksi    nHRMIyFD   gHPn      2009-12-05  -<span style="color: #BB0000; text-decoration: underline;">8</span><span style="color: #BB0000;">172</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> VCfOjSus noTSZCjxmI mGAsRZdF   gh        1988-05-11 -<span style="color: #BB0000; text-decoration: underline;">10</span><span style="color: #BB0000;">032</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> RwvBDkNJ CawvEUAyr  EtaZmIBeJK wfmIn     1971-06-20  <span style="text-decoration: underline;">18</span>227</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> EngSilEF AD         xINeIh     oKVd      1973-07-07 -<span style="color: #BB0000; text-decoration: underline;">23</span><span style="color: #BB0000;">221</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> axJdjADg ZV         KbRddOMueZ ZfONo     2000-12-14    202</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> pzZxHxYI rEk        nCggoULhXd cIy       1976-06-19  <span style="text-decoration: underline;">15</span>893</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> UqSzDjOO BdRqmjgd   mHbGe      ZILkFHVh  2015-05-15 -<span style="color: #BB0000; text-decoration: underline;">19</span><span style="color: #BB0000;">569</span></span></span>
<span><span class="co">#&gt;    purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> purchase_1974-04-22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> purchase_1996-09-09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> purchase_2016-03-15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> purchase_2009-12-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> purchase_1988-05-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> purchase_1971-06-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> purchase_1973-07-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> purchase_2000-12-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> purchase_1976-06-19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> purchase_2015-05-15</span></span></code></pre></div>
<p>As we can see check constraint rule was applied to correctly create
<code>purchase_id</code> column.</p>
<p><strong>Note:</strong> Check constraint expressions are used to
detect column dependency and to create the checked column, only when the
ones are equality expressions (that means the expression contains
<code>==</code> operator). Such expression assures the column definition
is deterministic. In the future releases (depending on the user’s needs)
the check expression rule can be extended to the cases where expression
constains <code>&lt;</code> and <code>&gt;</code> operators.</p>
<p>Now let’s take care to assure that <code>book_id</code> is the first
8 letters of concatenation of <code>author</code>, <code>title</code>
and <code>bought</code>-year. Such example can be also described using
check constraint, but we’ll use a different method that opens various
options for defining column rules.</p>
<p>If you want to create a column using custom expression, you pass it
as a <code>formula</code> parameter in yaml configuration file. In our
case, we want <code>book_id</code> be created with expression
<code>paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))</code>.
Let’s put it in configuration as <code>formula</code> parameter:</p>
<pre><code># schema-books_3.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>Again, update the source and plot column dependencies:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_3.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_methods_files/figure-html/unnamed-chunk-4-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>The column dependencies are detected correctly. Let’s move then to
simulation step:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author     title     genre      bought     amount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> vTcK2007     vTc        K         vwHCWAF    2007-06-14 -<span style="color: #BB0000; text-decoration: underline;">17</span><span style="color: #BB0000;">869</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> oYJHqbnQ1997 oYJHEpyDP  qbnQ      a          1997-03-16  <span style="text-decoration: underline;">11</span>240</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PyfNq2007    Pyf        Nq        wEcoZjiczZ 2007-03-16 -<span style="color: #BB0000; text-decoration: underline;">15</span><span style="color: #BB0000;">864</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> QDiNxcpm1979 QDiNktG    xcpmbzYN  Nm         1979-05-20 -<span style="color: #BB0000; text-decoration: underline;">32</span><span style="color: #BB0000;">045</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> vLKIkQH1974  vLK        IkQH      ipc        1974-04-06    638</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> yvZMNMnt1982 yvZMs      NMnt      s          1982-07-03  <span style="text-decoration: underline;">24</span>789</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> wCQqZYEh2014 wCQqGTzWP  ZYEhJMaXH dZt        2014-01-05  -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">823</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PdYrIPlM1988 PdYrd      IPlM      GebYogVMQy 1988-05-13 -<span style="color: #BB0000; text-decoration: underline;">30</span><span style="color: #BB0000;">463</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> jCWJ2003     jCW        J         ayYLMBSykj 2003-03-16 -<span style="color: #BB0000; text-decoration: underline;">18</span><span style="color: #BB0000;">411</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> KKjBfTy1977  KKjBXmcVTU fTy       qEq        1977-10-21  <span style="text-decoration: underline;">18</span>874</span></span>
<span><span class="co">#&gt;    purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> purchase_2007-06-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> purchase_1997-03-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> purchase_2007-03-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> purchase_1979-05-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> purchase_1974-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> purchase_1982-07-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> purchase_2014-01-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> purchase_1988-05-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> purchase_2003-03-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> purchase_1977-10-21</span></span></code></pre></div>
<p>As we can see the result is again as expected.</p>
<p><strong>Note</strong> The formula expression is passed to
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code> in the implementation, which means you may
use in the formula any dplyr-specific functions, such as
<code>n()</code>.</p>
<p><strong>Note</strong> Formula-based column definition was classified
as a ‘Deterministic simulation’ method, but you may also define formulas
with random sampling inside. For example assuring that column
<code>end_date</code> have values larger than <code>start_date</code>
you may define:
<code>formula: start_date + sample(1:10, dplyr::n(), replace = TRUE)</code>.</p>
</div>
<div class="section level3">
<h3 id="special-method-simulation">Special method simulation<a class="anchor" aria-label="anchor" href="#special-method-simulation"></a>
</h3>
<p>Let’s take a look at the last simulated data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author     title     genre      bought     amount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> vTcK2007     vTc        K         vwHCWAF    2007-06-14 -<span style="color: #BB0000; text-decoration: underline;">17</span><span style="color: #BB0000;">869</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> oYJHqbnQ1997 oYJHEpyDP  qbnQ      a          1997-03-16  <span style="text-decoration: underline;">11</span>240</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PyfNq2007    Pyf        Nq        wEcoZjiczZ 2007-03-16 -<span style="color: #BB0000; text-decoration: underline;">15</span><span style="color: #BB0000;">864</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> QDiNxcpm1979 QDiNktG    xcpmbzYN  Nm         1979-05-20 -<span style="color: #BB0000; text-decoration: underline;">32</span><span style="color: #BB0000;">045</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> vLKIkQH1974  vLK        IkQH      ipc        1974-04-06    638</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> yvZMNMnt1982 yvZMs      NMnt      s          1982-07-03  <span style="text-decoration: underline;">24</span>789</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> wCQqZYEh2014 wCQqGTzWP  ZYEhJMaXH dZt        2014-01-05  -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">823</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PdYrIPlM1988 PdYrd      IPlM      GebYogVMQy 1988-05-13 -<span style="color: #BB0000; text-decoration: underline;">30</span><span style="color: #BB0000;">463</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> jCWJ2003     jCW        J         ayYLMBSykj 2003-03-16 -<span style="color: #BB0000; text-decoration: underline;">18</span><span style="color: #BB0000;">411</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> KKjBfTy1977  KKjBXmcVTU fTy       qEq        1977-10-21  <span style="text-decoration: underline;">18</span>874</span></span>
<span><span class="co">#&gt;    purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> purchase_2007-06-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> purchase_1997-03-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> purchase_2007-03-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> purchase_1979-05-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> purchase_1974-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> purchase_1982-07-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> purchase_2014-01-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> purchase_1988-05-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> purchase_2003-03-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> purchase_1977-10-21</span></span></code></pre></div>
<p>As we mentioned in the previous section, we’re not happy with the
result of multiple column values. In this section we’ll take of the
result of <code>author</code> and <code>title</code> columns.</p>
<p>In case of <code>author</code> column, we’d like the values to be
random, human readable names. Across R packages, there are many that
offer such functionality. In case of DataFakeR, it’s just enough to
define <code>spec: name</code> for the column definition:</p>
<pre><code># schema-books_4.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(12)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>Again, update the source and plot column dependencies:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_4.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author            title      genre     bought     amount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Mr. eQDr1993 Mr. Elmore Hane   eQDr       rXovvKYq  1993-06-21   <span style="text-decoration: underline;">7</span>005</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SallOOPF1984 Sally Lubowitz    OOPFG      HN        1984-10-31   <span style="text-decoration: underline;">3</span>054</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AgushEpx1980 Agustus Schmidt   hEpx       X         1980-09-29 -<span style="color: #BB0000; text-decoration: underline;">20</span><span style="color: #BB0000;">733</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Dr. PdAf1972 Dr. Fabiola Huels PdAfHpFVNp RoTqbvVY  1972-07-07  <span style="text-decoration: underline;">29</span>393</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Dr. SUrn1988 Dr. Harper Kunze  SUrn       Hx        1988-05-10 -<span style="color: #BB0000; text-decoration: underline;">24</span><span style="color: #BB0000;">386</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DonnEDO1973  Donny Wuckert     EDO        PLVA      1973-04-22 -<span style="color: #BB0000; text-decoration: underline;">18</span><span style="color: #BB0000;">597</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AnicJ2013    Anice Jones PhD   J          cejZnE    2013-12-28  <span style="text-decoration: underline;">15</span>596</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> TavaLUwY2021 Tavaris Dicki     LUwYDHD    NcfFH     2021-06-03  <span style="text-decoration: underline;">18</span>248</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Hughbsga2018 Hugh Corkery      bsgaYOAM   KHvuAXgM  2018-12-30  -<span style="color: #BB0000; text-decoration: underline;">7</span><span style="color: #BB0000;">676</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ParajAXf1973 Paralee King      jAXf       QmNicoQmP 1973-03-18 -<span style="color: #BB0000; text-decoration: underline;">14</span><span style="color: #BB0000;">651</span></span></span>
<span><span class="co">#&gt;    purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> purchase_1993-06-21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> purchase_1984-10-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> purchase_1980-09-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> purchase_1972-07-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> purchase_1988-05-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> purchase_1973-04-22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> purchase_2013-12-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> purchase_2021-06-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> purchase_2018-12-30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> purchase_1973-03-18</span></span></code></pre></div>
<p>Voila!</p>
<p>How does it work?</p>
<p>Whenever you precise <code>spec</code> parameter to the column,
DataFakeR will look for the simulation options if the special method
with such name was defined. For the specific column type, such option is
defined at <code>options$opt_simul_spec_&lt;column-type&gt;</code>.</p>
<p>So for the default options and character column type, we have:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_simul_spec_character</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; function (n, not_null, unique, default, spec_params, na_ratio, </span></span>
<span><span class="co">#&gt;     levels_ratio, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     call_args &lt;- names(sys.call())</span></span>
<span><span class="co">#&gt;     if (!"spec_params" %in% call_args) {</span></span>
<span><span class="co">#&gt;         spec_params &lt;- list()</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     spec_params$n &lt;- n</span></span>
<span><span class="co">#&gt;     unique_sample(do.call(charlatan::ch_name, spec_params), spec_params = spec_params, </span></span>
<span><span class="co">#&gt;         unique = unique) %&gt;% levels_rand(unique = unique, levels_ratio = levels_ratio) %&gt;% </span></span>
<span><span class="co">#&gt;         na_rand(not_null = not_null, na_ratio = na_ratio)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x561825e3bc38&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></span></code></pre></div>
<p>The <code>name</code> method was defined and we were able to use it
in the simulation. Looking at the function body, we may see it uses
<code><a href="https://docs.ropensci.org/charlatan/reference/ch_name.html" class="external-link">charlatan::ch_name</a></code> function to simulate human-readable
names.</p>
<p>What else can we spot regarding the method definition? The below
points are worth notice:</p>
<ul>
<li>the method have <code>n</code> parameter. This is obligatory
parameter for each simulation method.</li>
<li>the method parameters also contain standard column ones from YAML
file. Whenever you need access to column parameters, just define them
while creating the method. DataFakeR passes all the column parameters
(not only the default ones) to each method.</li>
<li>if the parameter is not directly defined in the function it’s still
possible to access all of them by parsing ellipsis (…). Please make sure
ellipsis is always added as a function parameter.</li>
<li>by defining <code>spec_params</code> yaml configuration parameter
you may access and parse them directly in the method definition. Such
parameter allows to resolve conflicts with standard parameters names
when duplication exist.</li>
</ul>
<p>Now, let’s take care of preparing human-readable title. For this case
we’ll create our custom function. The titles will consist of combination
of four words from predefined values:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">books</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Learning"</span>, <span class="st">"Amusing"</span>, <span class="st">"Hiding"</span>, <span class="st">"Symbols"</span>, <span class="st">"Hunting"</span>, <span class="st">"Smile"</span><span class="op">)</span></span>
<span>  <span class="va">second</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Of"</span>, <span class="st">"On"</span>, <span class="st">"With"</span>, <span class="st">"From"</span>, <span class="st">"In"</span>, <span class="st">"Before"</span><span class="op">)</span></span>
<span>  <span class="va">third</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"My"</span>, <span class="st">"Your"</span>, <span class="st">"The"</span>, <span class="st">"Common"</span>, <span class="st">"Mysterious"</span>, <span class="st">"A"</span><span class="op">)</span></span>
<span>  <span class="va">fourth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Future"</span>, <span class="st">"South"</span>, <span class="st">"Technology"</span>, <span class="st">"Forest"</span>, <span class="st">"Storm"</span>, <span class="st">"Dreams"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">first</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">second</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">third</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">fourth</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s check a few possible results:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">books</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Hiding On Common South"       "Smile With My Forest"        </span></span>
<span><span class="co">#&gt; [3] "Amusing Of Mysterious Dreams"</span></span></code></pre></div>
<p>Perfect!</p>
<p>In order to present how <code>spec_params</code> can be used let’s
add an option to skip the second word in the result:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">books</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">add_second</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Learning"</span>, <span class="st">"Amusing"</span>, <span class="st">"Hiding"</span>, <span class="st">"Symbols"</span>, <span class="st">"Hunting"</span>, <span class="st">"Smile"</span><span class="op">)</span></span>
<span>  <span class="va">second</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Of"</span>, <span class="st">"On"</span>, <span class="st">"With"</span>, <span class="st">"From"</span>, <span class="st">"In"</span>, <span class="st">"Before"</span><span class="op">)</span></span>
<span>  <span class="va">third</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"My"</span>, <span class="st">"Your"</span>, <span class="st">"The"</span>, <span class="st">"Common"</span>, <span class="st">"Mysterious"</span>, <span class="st">"A"</span><span class="op">)</span></span>
<span>  <span class="va">fourth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Future"</span>, <span class="st">"South"</span>, <span class="st">"Technology"</span>, <span class="st">"Forest"</span>, <span class="st">"Storm"</span>, <span class="st">"Dreams"</span><span class="op">)</span></span>
<span>  <span class="va">second_res</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">add_second</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">second_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">second</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">first</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">second_res</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">third</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">fourth</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, let’s create the final method to use in the workflow.</p>
<p>The function needs to:</p>
<ul>
<li>take <code>n</code> parameter,</li>
<li>optional standard parameter <code>unique</code> (we’ll use it to
assure unique results are returned),</li>
<li>
<code>spec_params</code> that allows us to modify special method
parameters</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simul_spec_character_book</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">unique</span>, <span class="va">spec_params</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">spec_params</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span></span>
<span>  </span>
<span>  <span class="fu">DataFakeR</span><span class="fu">::</span><span class="fu"><a href="../reference/sample_modifiers.html">unique_sample</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">books</span>, <span class="va">spec_params</span><span class="op">)</span>, </span>
<span>    spec_params <span class="op">=</span> <span class="va">spec_params</span>, unique <span class="op">=</span> <span class="va">unique</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Before we run the example, let’s explain code blocks in function
definition.</p>
<p>We’re evaluating <code>books</code> using <code>do.call</code>.
That’s why we need to store all the parameters in the list passed to
<code>do.call</code>. The only missing one is <code>n</code>, so:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec_params</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span></span></code></pre></div>
<p>We allowed our method to respect <code>unique</code> parameter,
that’s why we want to assure the returned sample is unique. We may
achieve this using <code><a href="../reference/sample_modifiers.html">DataFakeR::unique_sample</a></code>.</p>
<p>The function evaluates sampling expression multiple times, replacing
duplicated values with the new ones. It’s worth to mention some of the
function parameters:</p>
<ul>
<li>
<code>sim_expr</code> - simulation expression to be evaluated,</li>
<li>
<code>...</code> - parameters values used in
<code>sim_expr</code>,</li>
<li>
<code>unique</code> - if TRUE, the function will try to generate
unique values,</li>
<li>
<code>n_iter</code> - number of iteration to try generate unique
value.</li>
</ul>
<p>So it’s enough to define:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DataFakeR</span><span class="fu">::</span><span class="fu"><a href="../reference/sample_modifiers.html">unique_sample</a></span><span class="op">(</span></span>
<span>  sim_expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">books</span>, <span class="va">spec_params</span><span class="op">)</span>, </span>
<span>  spec_params <span class="op">=</span> <span class="va">spec_params</span>, unique <span class="op">=</span> <span class="va">unique</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s modify configuration file with the <code>book</code> method
(with using <code>spec_params</code> to simulate full title):</p>
<pre><code>schema-books_5.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)</code></pre>
<p>and define the new method in the package options:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span></span>
<span>  opt_simul_spec_character <span class="op">=</span> <span class="fu"><a href="../reference/special_simulation.html">opt_simul_spec_character</a></span><span class="op">(</span>book <span class="op">=</span> <span class="va">simul_spec_character_book</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_source.html">schema_source</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_5.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span>, </span>
<span>  faker_opts <span class="op">=</span> <span class="va">my_opts</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author                   title                        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AliaSymb2005 Alia Thiel               Symbols With My Storm        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> FlorHidi1973 Florida Gottlieb         Hiding From Common Technology</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> RitaSmil1978 Rita Volkman PhD         Smile On The Future          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Mrs.Amus1974 Mrs. Prudence Deckow DDS Amusing From Common Future   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AlviSymb2004 Alvis Wolf               Symbols Before Common Forest </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> LindSmil1985 Lindell Abshire          Smile In Your Dreams         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> KareHidi1976 Kareem Kshlerin IV       Hiding On A Storm            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CarrSmil1985 Carrie McDermott         Smile Before Common South    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DevoLear2013 Devonte Hansen           Learning Before The Storm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AleaHunt1987 Alease Pouros            Hunting From The Future      </span></span>
<span><span class="co">#&gt;    genre      bought     amount purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> mKVIeGGTy  2005-05-12  <span style="text-decoration: underline;">15</span>135 purchase_2005-05-12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> dUnXYSEI   1973-04-24  -<span style="color: #BB0000; text-decoration: underline;">5</span><span style="color: #BB0000;">641</span> purchase_1973-04-24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> npNBcTycf  1978-02-13  <span style="text-decoration: underline;">27</span>090 purchase_1978-02-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DostQ      1974-05-05 -<span style="color: #BB0000; text-decoration: underline;">24</span><span style="color: #BB0000;">378</span> purchase_1974-05-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> CmGBYUpbPE 2004-03-03  <span style="text-decoration: underline;">29</span>926 purchase_2004-03-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> mqIf       1985-08-30   <span style="text-decoration: underline;">5</span>654 purchase_1985-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> kYodnY     1976-08-03 -<span style="color: #BB0000; text-decoration: underline;">31</span><span style="color: #BB0000;">808</span> purchase_1976-08-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> tmPdYwb    1985-07-31  <span style="text-decoration: underline;">19</span>944 purchase_1985-07-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> RSqpcXzQa  2013-12-18  <span style="text-decoration: underline;">19</span>069 purchase_2013-12-18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Wc         1987-04-18  <span style="text-decoration: underline;">27</span>308 purchase_1987-04-18</span></span></code></pre></div>
<p>Great! We’ve managed to use our custom special method to simulate
human-readable titles.</p>
<p>For the last part of this section it’s worth to mention the remaining
special methods for each column type. For numeric, integer, logical and
Date column classes, DataFakeR offer <code>spec: distr</code> method
that allow to simulate column from the selected distribution. The method
requires to provide:</p>
<pre><code>spec_params:
  method: &lt;method-name&gt;</code></pre>
<p>where method name is the name of simulation function such as
<code>rnorm</code>, <code>rbinom</code> etc.</p>
<p>For example, in order to simulate the column from normal distribution
with <code>mean = 10</code> and <code>sd = 5</code> we should
define:</p>
<pre><code><span><span class="va">spec</span><span class="op">:</span> <span class="va">distr</span></span>
<span><span class="va">spec_params</span><span class="op">:</span></span>
<span>  <span class="va">method</span><span class="op">:</span> <span class="va">rnorm</span></span>
<span>  <span class="va">mean</span><span class="op">:</span> <span class="fl">10</span></span>
<span>  <span class="va">sd</span><span class="op">:</span> <span class="fl">5</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="restricted-simulation">Restricted simulation<a class="anchor" aria-label="anchor" href="#restricted-simulation"></a>
</h3>
<p>Restricted simulation methods allow to simulate data considering
exceptional parameters defined for each column.</p>
<p>Such parameters can be for example:</p>
<ul>
<li>
<code>values</code> - possible column values for the target
column</li>
<li>
<code>range</code> - possible column values range for the target
column</li>
</ul>
<p>All the restricted methods offered by DataFakeR for column type are
defined in
<code>default_faker_opts$opt_simul_restricted_&lt;column-type&gt;</code>.</p>
<p>Let’s take a look what methods are offered for integer columns:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_simul_restricted_integer</span></span>
<span><span class="co">#&gt; $f_key</span></span>
<span><span class="co">#&gt; function (n, not_null, unique, default, type, values, na_ratio, </span></span>
<span><span class="co">#&gt;     levels_ratio, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (isTRUE(not_null)) {</span></span>
<span><span class="co">#&gt;         values &lt;- values[!is.na(values)]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if (isTRUE(unique)) {</span></span>
<span><span class="co">#&gt;         warning("Requested to simulate foreign key having unique values. Make sure config is correctly defined.")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     sample(values, n, replace = !unique) %&gt;% na_rand(not_null = not_null, </span></span>
<span><span class="co">#&gt;         na_ratio = na_ratio)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x561825d85fe0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $in_set</span></span>
<span><span class="co">#&gt; function (n, not_null, unique, default, type, values, na_ratio, </span></span>
<span><span class="co">#&gt;     levels_ratio, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (!missing(values)) {</span></span>
<span><span class="co">#&gt;         if (isTRUE(not_null)) {</span></span>
<span><span class="co">#&gt;             values &lt;- values[!is.na(values)]</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;         return(sample(values, n, replace = !unique) %&gt;% na_rand(not_null = not_null, </span></span>
<span><span class="co">#&gt;             na_ratio = na_ratio))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(NULL)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x561825d873c8&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $range</span></span>
<span><span class="co">#&gt; function (n, not_null, unique, default, type, range, na_ratio, </span></span>
<span><span class="co">#&gt;     levels_ratio, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (!missing(range)) {</span></span>
<span><span class="co">#&gt;         return(unique_sample(round(stats::runif(n, range[1], </span></span>
<span><span class="co">#&gt;             range[2])), range = range, n = n, unique = unique) %&gt;% </span></span>
<span><span class="co">#&gt;             na_rand(not_null = not_null, na_ratio = na_ratio))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(NULL)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x561825d833f8&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></span></code></pre></div>
<p>We can see there are three methods defined:</p>
<ul>
<li>
<code>f_key</code> - restricted method responsible for simulating
foreign keys (we’ll come back to this one in the last part of the
section),</li>
<li>
<code>range</code> - method taking <code>range</code> parameter.
When <code>range</code> is missing <code>NULL</code> is returned,
otherwise integers between <code>range[1]</code> and
<code>range[2]</code> are returned,</li>
<li>
<code>in_set</code>- method taking <code>values</code> parameter.
When <code>values</code> is missing <code>NULL</code> is returned,
otherwise sampled values from <code>values</code> are returned.</li>
</ul>
<p>Let’s highlight the general rule for restricted methods used by the
package (excluding <code>f_key</code> one):</p>
<ul>
<li>each method has <code>n</code> as obligatory parameter that
determines number of returned values,</li>
<li>standard column parameters (<code>not_null</code>,
<code>unique</code>, <code>type</code>) are optional but respected,</li>
<li>the method usually have defined ‘restriction’ parameter that
determines whether the method should be applied or not,</li>
<li>when restriction condition is not met (for example ‘restriction’
parameter is missing) the method should return <code>NULL</code>.</li>
</ul>
<p>The last point allows DataFakeR to scan across all the restriction
methods. When a method returns <code>NULL</code> result, the package
moves to simulate from the next method defined in
<code>opt_simul_restricted_&lt;column-type&gt;</code> setting.</p>
<p>Similar to special methods, you may also define a set of your custom
restricted methods. You may achieve this by setting up new methods
with:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_faker_opts</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  opt_simul_restricted_<span class="sc">&lt;</span>column<span class="sc">-</span>type<span class="sc">&gt;</span> <span class="er">=</span> opt_simul_restricted_<span class="sc">&lt;</span>column<span class="sc">-</span>type<span class="sc">&gt;</span>(<span class="at">my_method =</span> method, ...)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Note:</strong> DataFakeR allow also to rewrite currently
existing method. So whenever you need to rewrite for example
<code>in_set</code> method, just specify it as above.</p>
<p>Having the knowledge about restricted methods, let’s use them to
generate <code>amount</code> column from values between <code>1</code>
and <code>99</code>. We’ll do it by using range method for
<code>amount</code> column:</p>
<pre><code># schema-books_6.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
        bought:
          type: date
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_6.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author                    title                          </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> BranLear1997 Branson Kerluke           Learning From A South          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AutrSmil1998 Autry Brakus              Smile From A Storm             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Ms. Lear1970 Ms. Delphia Yundt DVM     Learning From Your Storm       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> TeniHidi2003 Tenisha Beier             Hiding From Mysterious South   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> MilfSmil1997 Milford Stanton-VonRueden Smile With Mysterious South    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> IvorHidi1996 Ivory Fahey               Hiding Of My Forest            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> MelbLear1984 Melba Lehner              Learning With Common Technology</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Mrs.Amus2017 Mrs. Malaya Wolf DVM      Amusing On My Storm            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Dr. Symb2013 Dr. Tabetha Ferry         Symbols Of Your Forest         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> MeyeSymb2002 Meyer Stamm-Hintz         Symbols From Mysterious Storm  </span></span>
<span><span class="co">#&gt;    genre      bought     amount purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ysosUqWUZ  1997-10-07     75 purchase_1997-10-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> CFDcnO     1998-01-05     52 purchase_1998-01-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ATojacy    1970-11-01     97 purchase_1970-11-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> QZnAjphst  2003-03-03     11 purchase_2003-03-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> RQTDi      1997-07-04     59 purchase_1997-07-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> lfwZjb     1996-08-26     86 purchase_1996-08-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> TyqsEy     1984-02-23     32 purchase_1984-02-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> oRjRQTg    2017-09-10     64 purchase_2017-09-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> nTyuinThgz 2013-09-09     66 purchase_2013-09-09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ToWVIacj   2002-08-16     92 purchase_2002-08-16</span></span></code></pre></div>
<p>Awesome! Let’s simulate now human-readable book genre from a set of
defined values. We can achieve this using <code>in_set</code> method for
character column type:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_simul_restricted_character</span><span class="op">$</span><span class="va">in_set</span></span>
<span><span class="co">#&gt; function (n, not_null, unique, default, nchar, type, values, </span></span>
<span><span class="co">#&gt;     na_ratio, levels_ratio, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (!missing(values)) {</span></span>
<span><span class="co">#&gt;         if (isTRUE(not_null)) {</span></span>
<span><span class="co">#&gt;             values &lt;- values[!is.na(values)]</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;         return(sample(values, n, replace = !unique) %&gt;% na_rand(not_null = not_null, </span></span>
<span><span class="co">#&gt;             na_ratio = na_ratio))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(NULL)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x561825e39378&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:DataFakeR&gt;</span></span></code></pre></div>
<p>So let’s assume we want the genre to be simulated from set:
<code>Fantasy</code>, <code>Adventure</code>, <code>Horror</code>,
<code>Romance</code>.</p>
<p>Let’s define such set as possible <code>values</code> for
<code>genre</code> column:</p>
<pre><code>schema-books_7.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
          values: [Fantasy, Adventure, Horror, Romance]
        bought:
          type: date
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_7.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author                   title                         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> RylaHidi1970 Rylan Prosacco           Hiding From The Dreams        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> TripAmus1979 Tripp Armstrong          Amusing From Mysterious Future</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> TainSmil1999 Taina Steuber            Smile In Mysterious Storm     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Ova Lear2020 Ova Hettinger            Learning With The Technology  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Dr. Lear1994 Dr. Alphonse Watsica Sr. Learning In A Technology      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DevoSmil1975 Devonte McClure          Smile Before The Forest       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ConaLear2019 Conard Volkman-Walker    Learning In A Future          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> EloySymb1982 Eloy Ratke III           Symbols Before A Forest       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PhoeSymb1975 Phoebe Swaniawski        Symbols On Mysterious Dreams  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AdelSymb1997 Adeline Block PhD        Symbols With Common Dreams    </span></span>
<span><span class="co">#&gt;    genre     bought     amount purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Adventure 1970-09-14     98 purchase_1970-09-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Romance   1979-11-11     46 purchase_1979-11-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Horror    1999-12-14     44 purchase_1999-12-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Romance   2020-02-18     19 purchase_2020-02-18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Adventure 1994-06-04     39 purchase_1994-06-04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Fantasy   1975-06-09     95 purchase_1975-06-09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Romance   2019-06-17     17 purchase_2019-06-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Adventure 1982-02-11     38 purchase_1982-02-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Romance   1975-05-07      7 purchase_1975-05-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Romance   1997-02-05     28 purchase_1997-02-05</span></span></code></pre></div>
<p>Let’s add the last improvement by specifying date range for
books:</p>
<pre><code>schema-books_8.yml
public:
  tables:
    books:
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
          values: [Fantasy, Adventure, Horror, Romance]
        bought:
          type: date
          range: ['2020-01-02', '2021-06-01']
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_8.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author                  title                          </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DomoHunt2021 Domonique Hettinger     Hunting In Mysterious Storm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ShaeHidi2020 Shae Daugherty          Hiding Before Mysterious Future</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> HopeHunt2020 Hope Murphy-Cremin      Hunting On Common Forest       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> MalaSmil2020 Malaya Rippin-Feil      Smile Of Your Technology       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ChriSmil2021 Christoper Kerluke      Smile Of My Dreams             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> LeeaLear2020 Leeann Rice             Learning In Your Storm         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Mrs.Hidi2020 Mrs. Alys Dickinson DVM Hiding On A Storm              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ChriAmus2020 Christin Padberg DVM    Amusing In Common South        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DeboSmil2020 Debora Schamberger      Smile Of The South             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> EzzaHidi2020 Ezzard Keeling          Hiding On Your Forest          </span></span>
<span><span class="co">#&gt;    genre     bought     amount purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Adventure 2021-01-02     86 purchase_2021-01-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Fantasy   2020-04-12     10 purchase_2020-04-12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Adventure 2020-07-11     15 purchase_2020-07-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Adventure 2020-06-11     78 purchase_2020-06-11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Adventure 2021-04-16     48 purchase_2021-04-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Horror    2020-06-05     65 purchase_2020-06-05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Romance   2020-08-17      3 purchase_2020-08-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Fantasy   2020-08-02     69 purchase_2020-08-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Horror    2020-05-20     68 purchase_2020-05-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Adventure 2020-09-15     19 purchase_2020-09-15</span></span></code></pre></div>
<p>Here we are.</p>
<p>For the last part of restricted methods, let’s add a few words about
<code>f_key</code> restricted method.</p>
<p>As mentioned the method is responsible for simulating foreign key
columns. When the column is defined in schema as a foreign key,
DataFakeR will source possible values from the parent table and pass
such values set as a <code>values</code> parameter to <code>f_key</code>
method.</p>
<p>Simulating foreign key will skip execution of the remaining
restricted methods defined in options.</p>
<p>To see it in action, let’s extend our schema definition by adding a
new <code>borrowed</code> table (let’s also precise <code>nrows</code>
for each table).</p>
<pre><code># schema-books_9.yml
public:
  tables:
    books:
      nrows: 10
      columns:
        book_id:
          type: char(8)
          formula: !expr paste0(substr(author, 1, 4), substr(title, 1, 4), substr(bought, 1, 4))
        author:
          type: varchar
          spec: name
        title:
          type: varchar
          spec: book
          spec_params:
            add_second: true
        genre:
          type: varchar
          values: [Fantasy, Adventure, Horror, Romance]
        bought:
          type: date
          range: ['2020-01-02', '2021-06-01']
        amount:
          type: smallint
          range: [1, 99]
        purchase_id:
          type: varchar
      check_constraints:
        purchase_id_check:
          column: purchase_id
          expression: !expr purchase_id == paste0('purchase_', bought)
    borrowed:
      nrows: 30
      columns:
        book_id:
          type: char(8)
        user_id:
          type: char(10)
      foreign_keys:
        book_id_fkey:
          columns: book_id
          references:
            columns: book_id
            table: books</code></pre>
<p>Let’s update the file and check table dependencies:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-books_9.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulation_methods_files/figure-html/unnamed-chunk-22-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>As shown, DataFakeR detected dependency between <code>books</code>
and <code>borrowed</code>, and will generate <code>books</code> table
first to get possible values for foreign key column.</p>
<p>Let’s simulate the data and compare simumlated book ids:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"books"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    book_id      author                 title                         genre    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ThedSymb2020 Theda Hamill           Symbols In The Future         Horror   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> QueeLear2021 Queenie Klein-Predovic Learning Of Mysterious Forest Romance  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AdamAmus2020 Adam Hills             Amusing From Common Storm     Fantasy  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> BranHunt2021 Brandin Zboncak DDS    Hunting On Common Technology  Adventure</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Mrs.Hidi2020 Mrs. Louise Vandervort Hiding From My South          Horror   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Dr. Symb2021 Dr. Clarence Beier     Symbols With The Storm        Romance  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ShanHunt2020 Shannon Bode           Hunting Of Your Dreams        Romance  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DarrHunt2020 Darrien Schuster       Hunting From A Forest         Fantasy  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> MariHunt2020 Maritza Mosciski       Hunting In The Forest         Adventure</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Mr. Amus2020 Mr. Clinton Herzog DVM Amusing Of Mysterious Future  Romance  </span></span>
<span><span class="co">#&gt;    bought     amount purchase_id        </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2020-09-02     62 purchase_2020-09-02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2021-01-10     83 purchase_2021-01-10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2020-07-22     17 purchase_2020-07-22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2021-02-16     49 purchase_2021-02-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2020-01-23      9 purchase_2020-01-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2021-01-20     36 purchase_2021-01-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2020-08-16     52 purchase_2020-08-16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2020-06-18     14 purchase_2020-06-18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2020-01-19     54 purchase_2020-01-19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2020-08-23     89 purchase_2020-08-23</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"borrowed"</span><span class="op">)</span><span class="op">$</span><span class="va">book_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "QueeLear2021" "Mr. Amus2020" NA             "AdamAmus2020" "MariHunt2020"</span></span>
<span><span class="co">#&gt; [6] "ThedSymb2020" "Mrs.Hidi2020" "BranHunt2021" "DarrHunt2020"</span></span></code></pre></div>
<p>So the values were correctly inherited from parent table.</p>
</div>
<div class="section level2">
<h2 id="default-simulation">Default simulation<a class="anchor" aria-label="anchor" href="#default-simulation"></a>
</h2>
<p>When none of the above methods were applied DataFakeR will simulate
the column using the default method. For each column type you may find
the default methods defined at
<code>default_faker_opts$default_faker_opts$opt_simul_default_fun_&lt;column-type&gt;</code>.</p>
<p>In order to overwrite such method it’s just enough to:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_faker_opts</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  opt_simul_default_fun_<span class="sc">&lt;</span>column<span class="sc">-</span>type<span class="sc">&gt;</span> <span class="er">=</span> my_custom_method</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Krystian Igras.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
