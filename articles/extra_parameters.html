<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extra parameters • DataFakeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extra parameters">
<meta property="og:description" content="DataFakeR">
<meta property="og:image" content="https://openpharma.github.io/DataFakeR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataFakeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-thumbs-o-up"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/main.html">Welcome</a>
    </li>
    <li>
      <a href="../articles/datafaker_workflow.html">DataFakeR workflow</a>
    </li>
    <li>
      <a href="../articles/schema_structure.html">YAML schema structure</a>
    </li>
    <li>
      <a href="../articles/structure_from_db.html">Sourcing structure from database</a>
    </li>
    <li>
      <a href="../articles/simulation_options.html">Simulation Options</a>
    </li>
    <li>
      <a href="../articles/simulation_methods.html">Simulation Methods</a>
    </li>
    <li>
      <a href="../articles/extra_parameters.html">Extra parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/openpharma/DataFakeR/issues" class="external-link">
    <span class="fa fa-ambulance"></span>
     
    Issues
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/DataFakeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extra parameters</h1>
                        <h4 data-toc-skip class="author">Krystian
Igras</h4>
            
            <h4 data-toc-skip class="date">2023-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DataFakeR/blob/HEAD/vignettes/extra_parameters.Rmd" class="external-link"><code>vignettes/extra_parameters.Rmd</code></a></small>
      <div class="hidden name"><code>extra_parameters.Rmd</code></div>

    </div>

    
    
<p>Most of the functionality offered by DataFakeR were described in the
remaining vignettes. Goal of this section is to present additional
options offered by DataFakeR that can make your data simulating workflow
much easier.</p>
<div class="section level3">
<h3 id="grouped-simulation">Grouped simulation<a class="anchor" aria-label="anchor" href="#grouped-simulation"></a>
</h3>
<p>It is quite common that values of the column are strongly related to
the groups defined by the other column values.</p>
<p>Some of the examples may be the age of death that may differ between
males and females.</p>
<p>In order to allow simulating values based on groups designed by the
other columns, <code>group_by</code> parameter was introduced.</p>
<p>Let’s see the below schema structure:</p>
<pre><code># schema-patient.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
        line_number: 
          type: smallint
        gender:
          type: char(1)
          values: [F, M]
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>Let’s simulate the data using the below definition:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_source.html">schema_source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-patient.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    treatment_id   patient_id line_number gender biomarker</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> OoVtwCbu-16802 OoVtwCbu        -<span style="color: #BB0000; text-decoration: underline;">16</span><span style="color: #BB0000;">802</span> M          0.600</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cXxXjdFu11013  cXxXjdFu         <span style="text-decoration: underline;">11</span>013 M          0.333</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> MCRxukhz-5398  MCRxukhz         -<span style="color: #BB0000; text-decoration: underline;">5</span><span style="color: #BB0000;">398</span> F          0.489</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ikcePHyu18886  ikcePHyu         <span style="text-decoration: underline;">18</span>886 M          0.954</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> jpBYnLQM-26027 jpBYnLQM        -<span style="color: #BB0000; text-decoration: underline;">26</span><span style="color: #BB0000;">027</span> M          0.483</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HVVTHHMY-4267  HVVTHHMY         -<span style="color: #BB0000; text-decoration: underline;">4</span><span style="color: #BB0000;">267</span> F          0.890</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> NsCWpGdK31781  NsCWpGdK         <span style="text-decoration: underline;">31</span>781 F          0.914</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> GnuTiETO25758  GnuTiETO         <span style="text-decoration: underline;">25</span>758 M          0.609</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> qXqqpWng25327  qXqqpWng         <span style="text-decoration: underline;">25</span>327 F          0.411</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> kAYLTfSF-21296 kAYLTfSF        -<span style="color: #BB0000; text-decoration: underline;">21</span><span style="color: #BB0000;">296</span> F          0.147</span></span></code></pre></div>
<p>Now we’d like to extend the definition following the below rules:</p>
<ol style="list-style-type: decimal">
<li>For each <code>patient_id</code> we usually want to have more than
one row (it allows us to analyze the patient in multiple treatment
stages).</li>
<li>For each <code>patient_id</code>, <code>lineid</code> is the
sequence starting from 1 to the number of patient rows.</li>
<li>
<code>gender</code> should be unique for each
<code>patient_id</code> value.</li>
<li>
<code>biomarker</code> value should <code>mean = 0.5</code> for
females and <code>mean = 0.6</code> for males.</li>
</ol>
<div class="section level4">
<h4 id="rule-no-1">Rule no 1<a class="anchor" aria-label="anchor" href="#rule-no-1"></a>
</h4>
<p>Let’s start with condition 1. We may simply achieve this by providing
possible <code>patient_id</code> values with unique number less than
target number of rows.</p>
<pre><code># schema-patient_2.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number: 
          type: smallint
        gender:
          type: char(1)
          values: [F, M]
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>Let’s simulate the data using the below definition:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-patient_2.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    treatment_id   patient_id line_number gender biomarker</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PTNT02ID-8554  PTNT02ID         -<span style="color: #BB0000; text-decoration: underline;">8</span><span style="color: #BB0000;">554</span> M         0.843 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PTNT03ID31733  PTNT03ID         <span style="text-decoration: underline;">31</span>733 M         0.231 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PTNT01ID-22662 PTNT01ID        -<span style="color: #BB0000; text-decoration: underline;">22</span><span style="color: #BB0000;">662</span> M         0.239 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PTNT02ID-26801 PTNT02ID        -<span style="color: #BB0000; text-decoration: underline;">26</span><span style="color: #BB0000;">801</span> M         0.076<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PTNT02ID-23468 PTNT02ID        -<span style="color: #BB0000; text-decoration: underline;">23</span><span style="color: #BB0000;">468</span> M         0.246 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PTNT03ID12452  PTNT03ID         <span style="text-decoration: underline;">12</span>452 F         0.732 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PTNT02ID7815   PTNT02ID          <span style="text-decoration: underline;">7</span>815 M         0.847 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PTNT01ID25650  PTNT01ID         <span style="text-decoration: underline;">25</span>650 M         0.498 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PTNT03ID11337  PTNT03ID         <span style="text-decoration: underline;">11</span>337 M         0.388 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PTNT03ID15536  PTNT03ID         <span style="text-decoration: underline;">15</span>536 F         0.246</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rule-no-2">Rule no 2<a class="anchor" aria-label="anchor" href="#rule-no-2"></a>
</h4>
<p>Now, we’d like to make sure <code>line_id</code> is a sequence
<code>1:n</code>, where <code>n</code> is the number of rows for each
patient.</p>
<p>If we define <code>line_number</code> formula as
<code>!expr 1:dplyr::n()</code>, the resulting column would be a
sequence <code>1:n</code> where <code>n</code> is the number of table
rows. There is an obvious need to apply grouping by
<code>patient_id</code>.</p>
<p>How can we achieve this in DataFakeR?</p>
<p>It is enough to add <code>group_by: patient_id</code> parameter to
<code>line_number</code>.</p>
<p>Let’s see it in action:</p>
<pre><code># schema-patient_3.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number: 
          type: smallint
          group_by: patient_id
          formula: !expr 1:dplyr::n()
        gender:
          type: char(1)
          values: [F, M]
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>Looking at the dependency graph:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span><span class="va">sch</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-patient_3.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_plot_deps</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></span></code></pre></div>
<p><img src="extra_parameters_files/figure-html/unnamed-chunk-3-1.png" width="1600" style="display: block; margin: auto;"></p>
<p>we can see, DataFakeR detected dependency between
<code>patient_id</code> and <code>line_numer</code> column.</p>
<p><code>line_number</code> was also created according to our needs:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    treatment_id patient_id line_number gender biomarker</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PTNT03ID1    PTNT03ID             1 F         0.974 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PTNT02ID1    PTNT02ID             1 F         0.760 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PTNT02ID2    PTNT02ID             2 M         0.887 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PTNT02ID3    PTNT02ID             3 M         0.222 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PTNT01ID1    PTNT01ID             1 F         0.270 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PTNT02ID4    PTNT02ID             4 M         0.607 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PTNT02ID5    PTNT02ID             5 F         0.340 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PTNT02ID6    PTNT02ID             6 M         0.757 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PTNT01ID2    PTNT01ID             2 M         0.074<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PTNT02ID7    PTNT02ID             7 M         0.891</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rule-no-3">Rule no 3<a class="anchor" aria-label="anchor" href="#rule-no-3"></a>
</h4>
<p>Now let’s assure gender is unique for each patient.</p>
<p>To achieve this, we’ll have to group by <code>patient_id</code> and
sample one value from <code>c("F", "M)</code> and repeat this with
desired number of rows.</p>
<p>We may again use the formula, but for the sake of the example we’ll
define custom restricted method.</p>
<p>The method will be executed whenever <code>singular: true</code>
parameter is provided to the column.</p>
<pre><code># schema-patient_4.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number: 
          type: smallint
          group_by: patient_id
          formula: !expr 1:dplyr::n()
        gender:
          type: char(1)
          values: [F, M]
          singular: true
          group_by: patient_id
        biomarker:
          type: numeric
          range: [0, 1]</code></pre>
<p>The method definition:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">singular_vals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">values</span>, <span class="va">singular</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">singular</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">singular</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">values</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">val</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>and add it to schema options:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_opts</span> <span class="op">=</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span></span>
<span>  opt_simul_restricted_character <span class="op">=</span> <span class="fu"><a href="../reference/restricted_simulation.html">opt_simul_restricted_character</a></span><span class="op">(</span></span>
<span>    singular <span class="op">=</span> <span class="va">singular_vals</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we can start simulation:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span></span>
<span>  <span class="va">sch</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-patient_4.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span>,</span>
<span>  <span class="va">my_opts</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    treatment_id patient_id line_number gender biomarker</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PTNT01ID1    PTNT01ID             1 F         0.732 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PTNT02ID1    PTNT02ID             1 F         0.973 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PTNT02ID2    PTNT02ID             2 F         0.311 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PTNT01ID2    PTNT01ID             2 F         0.716 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PTNT01ID3    PTNT01ID             3 F         0.595 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PTNT02ID3    PTNT02ID             3 F         0.043<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PTNT02ID4    PTNT02ID             4 F         0.449 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PTNT02ID5    PTNT02ID             5 F         0.639 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PTNT03ID1    PTNT03ID             1 M         0.801 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PTNT01ID4    PTNT01ID             4 F         0.542</span></span></code></pre></div>
<p>Voila!</p>
</div>
<div class="section level4">
<h4 id="rule-no-4">Rule no 4<a class="anchor" aria-label="anchor" href="#rule-no-4"></a>
</h4>
<p>We’d like to sample from normal distribution with a specific mean
dependent on the gender value.</p>
<p>Again we have a few options here. The simplest one would be to group
<code>biomarker</code> by <code>gender</code> and use:</p>
<p><code>formula: ifelse(gender == "F", rnorm(dplyr::n(), 0.5, 0.01), rnorm(dplyr::n(), 0.6, 0.01))</code></p>
<p>but we’ll do it using a special method instead.</p>
<p>The main issue we might have is how to access the group value from
within the method. We shouldn’t be worried. DataFakeR automatically
passes the value as a <code>group_val</code> parameter.</p>
<p>So let’s try it out.</p>
<p>Let’s define spec method named <code>dep_sampl</code>:</p>
<pre><code># schema-patient_5.yml
public:
  tables:
    patient:
      columns:
        treatment_id:
          type: varchar
          formula: !expr paste0(patient_id, line_number)
        patient_id:
          type: char(8)
          values: [PTNT01ID, PTNT02ID, PTNT03ID]
        line_number:
          type: smallint
          group_by: patient_id
          formula: !expr 1:dplyr::n()
        gender:
          type: char(1)
          values: [F, M]
          singular: true
          group_by: patient_id
        biomarker:
          type: numeric
          range: [0, 1]
          spec: dep_sampl
          group_by: gender</code></pre>
<p>Inside function definition let’s add print line to see current
<code>group_key</code> value:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dep_sampl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">group_val</span>, <span class="va">range</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">group_val</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">group_val</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.6</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.5</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_opts</span> <span class="op">=</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span></span>
<span>  opt_simul_spec_numeric <span class="op">=</span> <span class="fu"><a href="../reference/special_simulation.html">opt_simul_spec_numeric</a></span><span class="op">(</span></span>
<span>    dep_sampl <span class="op">=</span> <span class="va">dep_sampl</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># don't forget option from previous case</span></span>
<span>  opt_simul_restricted_character <span class="op">=</span> <span class="fu"><a href="../reference/restricted_simulation.html">opt_simul_restricted_character</a></span><span class="op">(</span></span>
<span>    singular <span class="op">=</span> <span class="va">singular_vals</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_update_source</a></span><span class="op">(</span></span>
<span>  <span class="va">sch</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"schema-patient_5.yml"</span>, package <span class="op">=</span> <span class="st">"DataFakeR"</span><span class="op">)</span>, </span>
<span>  <span class="va">my_opts</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/schema_methods.html">schema_simulate</a></span><span class="op">(</span><span class="va">sch</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "M"</span></span>
<span><span class="fu"><a href="../reference/schema_methods.html">schema_get_table</a></span><span class="op">(</span><span class="va">sch</span>, <span class="st">"patient"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    treatment_id patient_id line_number gender biomarker</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PTNT02ID1    PTNT02ID             1 M          0.602</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PTNT01ID1    PTNT01ID             1 M          0.587</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PTNT03ID1    PTNT03ID             1 M          0.589</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> PTNT02ID2    PTNT02ID             2 M          0.599</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PTNT03ID2    PTNT03ID             2 M          0.603</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PTNT03ID3    PTNT03ID             3 M          0.600</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PTNT01ID2    PTNT01ID             2 M          0.600</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PTNT03ID4    PTNT03ID             4 M          0.599</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PTNT03ID5    PTNT03ID             5 M          0.594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PTNT02ID3    PTNT02ID             3 M          0.608</span></span></code></pre></div>
<p>This way we achieved assumed goal.</p>
</div>
</div>
<div class="section level3">
<h3 id="ratio-of-na-values">Ratio of NA values<a class="anchor" aria-label="anchor" href="#ratio-of-na-values"></a>
</h3>
<p>Another extra parameter offered by DataFakeR is
<code>na_ratio</code>. Na ratio allows to precise the ratio of how many
NA values should the column have.</p>
<p>For each simulation method the final sample is modified by <a href="../reference/sample_modifiers.html">na_rand</a> function, that
replaces desired ratio of values with <code>NA</code>s. Default
<code>na_ratio</code> value is <code>0.05</code> but can be easily
overwritten by <code>opt_default_</code> configuration, or passed
directly in column definition.</p>
<p><strong>Note</strong> Whenever column have defined
<code>not_null: true</code>, <code>na_rand</code> doesn’t attach
<code>NA</code> values to the sample.</p>
</div>
<div class="section level3">
<h3 id="ratio-of-column-values">Ratio of column values<a class="anchor" aria-label="anchor" href="#ratio-of-column-values"></a>
</h3>
<p>The last extra parameter offered by DataFakeR is
<code>levels_ratio</code>. Levels ratio allows to precise how many
unique values should the column have.</p>
<p>For each simulation method (before the sample is modified by
<code>na_rand</code>) the sample is modified by <a href="../reference/sample_modifiers.html">levels_rand</a> function, that
takes desired number of sample levels and resamples it using only
provided levels. Default <code>levels_ratio</code> is <code>1</code> but
can be easily overwritten by <code>opt_default_</code> configuration, or
passed directly in column definition.</p>
<p><strong>Note</strong> Whenever column have defined
<code>unique: true</code> or <code>levels_ratio: 1</code>,
<code>levels_rand</code> doesn’t modify the sample.</p>
</div>
<div class="section level3">
<h3 id="remaining-parameters">Remaining parameters<a class="anchor" aria-label="anchor" href="#remaining-parameters"></a>
</h3>
<p>There are a few parameters that can be configured to each column and
be handled by <a href="simulation_methods.html">all the simulation
methods</a>.</p>
<p>Such parameters are:</p>
<ul>
<li>
<code>values</code> - The parameter keeps possible values for the
simulated column,</li>
<li>
<code>range</code> - Two-length parameter storing minimum and
maximum value for simulated column (numeric, integer and date
only),</li>
<li>
<code>precision</code> - Precision of numeric column values,</li>
<li>
<code>scale</code> - Scale of numeric column values,</li>
<li>
<code>min_date</code>, <code>max_date</code> - minimal and maximal
values for simulating date columns (overwritten by <code>range</code>
when specified),</li>
<li>
<code>format</code> - Date format of <code>min_date</code>,
<code>max_date</code> and <code>range</code> in case of date columns
(%Y-%m-%d by default),</li>
<li>
<code>nchar</code> - Maximum number of characters for simulating
character column (10 by default).</li>
</ul>
<p>Whenever any of the above parameters is defined as a parameter of
column-type simulation method, such value can be used to get more
accurate result respecting the configuration.</p>
<p>For example default character simulation method (<a href="../reference/simulation_methods_character.html">simul_default_character</a>)
takes an advantage of <code>nchar</code> parameter, but special method
for simulating names don’t (<a href="../reference/simulation_methods_character.html">simul_spec_character_name</a>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Krystian Igras.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
